# üê≥ –ë–∞–≥–∞—Ç–æ—Å—Ç—É–ø–µ–Ω–µ–≤–∞ Docker –∑–±—ñ—Ä–∫–∞ –¥–ª—è Speech Commands Classification

## üìã –û–ø–∏—Å –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏

–¶–µ–π –ø—Ä–æ–µ–∫—Ç –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **–±–∞–≥–∞—Ç–æ—Å—Ç—É–ø–µ–Ω–µ–≤—É –∑–±—ñ—Ä–∫—É Docker (multi-stage build)** –∑ —Ç—Ä—å–æ–º–∞ –µ—Ç–∞–ø–∞–º–∏:

### –ï—Ç–∞–ø 1: Builder (–±–∞–∑–æ–≤–∏–π –æ–±—Ä–∞–∑)
- –í—Å—Ç–∞–Ω–æ–≤–ª—é—î –≤—Å—ñ —Å–∏—Å—Ç–µ–º–Ω—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ (ffmpeg, libsndfile1, build-essential)
- –í—Å—Ç–∞–Ω–æ–≤–ª—é—î Python –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ (PyTorch, torchaudio, Flask —Ç–æ—â–æ)
- –ö–æ–ø—ñ—é—î –∫–æ–¥ –ø—Ä–æ–µ–∫—Ç—É

### –ï—Ç–∞–ø 2: Trainer (–Ω–∞–≤—á–∞–Ω–Ω—è –º–æ–¥–µ–ª—ñ)
- –ü–µ—Ä–µ–≤—ñ—Ä—è—î –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –Ω–∞—Ç—Ä–µ–Ω–æ–≤–∞–Ω–æ—ó –º–æ–¥–µ–ª—ñ `model_state_dict.pt`
- **–Ø–∫—â–æ –º–æ–¥–µ–ª—å –≤—ñ–¥—Å—É—Ç–Ω—è** ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–ø—É—Å–∫–∞—î `speech_commands_train.py`
- **–Ø–∫—â–æ –º–æ–¥–µ–ª—å —î** ‚Üí –ø—Ä–æ–ø—É—Å–∫–∞—î –µ—Ç–∞–ø –Ω–∞–≤—á–∞–Ω–Ω—è
- –ó–±–µ—Ä—ñ–≥–∞—î –Ω–∞–≤—á–µ–Ω—É –º–æ–¥–µ–ª—å

### –ï—Ç–∞–ø 3: Runtime (—Ñ—ñ–Ω–∞–ª—å–Ω–∏–π –æ–±—Ä–∞–∑)
- –õ–µ–≥–∫–∏–π –æ–±—Ä–∞–∑ —Ç—ñ–ª—å–∫–∏ –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è
- –ö–æ–ø—ñ—é—î –Ω–∞–≤—á–µ–Ω—É –º–æ–¥–µ–ª—å –∑ –µ—Ç–∞–ø—É trainer
- –ù–µ –º—ñ—Å—Ç–∏—Ç—å build-–∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π
- –ó–∞–ø—É—Å–∫–∞—î Flask API –¥–æ–¥–∞—Ç–æ–∫

## üöÄ –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç

### –í–∞—Ä—ñ–∞–Ω—Ç 1: –ó–±—ñ—Ä–∫–∞ –±–µ–∑ –≥–æ—Ç–æ–≤–æ—ó –º–æ–¥–µ–ª—ñ (–∑ –Ω–∞–≤—á–∞–Ω–Ω—è–º)

```bash
# –ó–±—É–¥—É–≤–∞—Ç–∏ –æ–±—Ä–∞–∑ (–º–æ–¥–µ–ª—å –Ω–∞–≤—á–∏—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—ñ–¥ —á–∞—Å –∑–±—ñ—Ä–∫–∏)
docker build -t speech-commands-app .

# –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker run -d -p 8000:8000 --name speech-app speech-commands-app

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ª–æ–≥–∏
docker logs -f speech-app
```

### –í–∞—Ä—ñ–∞–Ω—Ç 2: –ó–±—ñ—Ä–∫–∞ –∑ –≥–æ—Ç–æ–≤–æ—é –º–æ–¥–µ–ª–ª—é (—à–≤–∏–¥—à–µ)

```bash
# 1. –°–ø–æ—á–∞—Ç–∫—É –Ω–∞–≤—á—ñ—Ç—å –º–æ–¥–µ–ª—å –ª–æ–∫–∞–ª—å–Ω–æ (—è–∫—â–æ —â–µ –Ω–µ–º–∞—î)
python speech_commands_train.py

# 2. –ó–±—É–¥—É–π—Ç–µ –æ–±—Ä–∞–∑ (–µ—Ç–∞–ø –Ω–∞–≤—á–∞–Ω–Ω—è –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å—Å—è)
docker build -t speech-commands-app .

# 3. –ó–∞–ø—É—Å—Ç—ñ—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker run -d -p 8000:8000 --name speech-app speech-commands-app
```

### –í–∞—Ä—ñ–∞–Ω—Ç 3: –ö–æ–ø—ñ—é–≤–∞–Ω–Ω—è –≥–æ—Ç–æ–≤–æ—ó –º–æ–¥–µ–ª—ñ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

```bash
# –Ø–∫—â–æ —É –≤–∞—Å –≤–∂–µ —î –Ω–∞–≤—á–µ–Ω–∞ –º–æ–¥–µ–ª—å –ø–æ–∑–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º
docker build -t speech-commands-app .
docker run -d -p 8000:8000 \
    -v $(pwd)/model_state_dict.pt:/app/model_state_dict.pt \
    --name speech-app speech-commands-app
```

## üîç –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–±–æ—Ç–∏

### 1. Health check
```bash
curl http://localhost:8000/health
```

–í—ñ–¥–ø–æ–≤—ñ–¥—å:
```json
{
  "status": "healthy",
  "model_loaded": true,
  "device": "cpu"
}
```

### 2. –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –º–æ–¥–µ–ª—å
```bash
curl http://localhost:8000/info
```

### 3. –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
```bash
# –ü—Ä–∏–ø—É—Å—Ç–∏–º–æ, —É –≤–∞—Å —î –∞—É–¥—ñ–æ —Ñ–∞–π–ª test.wav
curl -X POST -F "file=@test.wav" http://localhost:8000/predict
```

### 4. –í–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å
–í—ñ–¥–∫—Ä–∏–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä—ñ: http://localhost:8000/

## üõ† –î–æ–¥–∞—Ç–∫–æ–≤—ñ –∫–æ–º–∞–Ω–¥–∏ Docker

### –ü–µ—Ä–µ–≥–ª—è–¥ –ª–æ–≥—ñ–≤
```bash
# –í—Å—ñ –ª–æ–≥–∏
docker logs speech-app

# –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ
docker logs -f speech-app

# –û—Å—Ç–∞–Ω–Ω—ñ 100 —Ä—è–¥–∫—ñ–≤
docker logs --tail 100 speech-app
```

### –ó—É–ø–∏–Ω–∫–∞ —ñ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
```bash
# –ó—É–ø–∏–Ω–∏—Ç–∏
docker stop speech-app

# –í–∏–¥–∞–ª–∏—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker rm speech-app

# –í–∏–¥–∞–ª–∏—Ç–∏ –æ–±—Ä–∞–∑
docker rmi speech-commands-app
```

### –Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∏–π —Ä–µ–∂–∏–º (–¥–ª—è –¥–µ–±–∞–≥—É)
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–∏ bash –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker run -it --rm speech-commands-app /bin/bash

# –ê–±–æ –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è –¥–æ –∑–∞–ø—É—â–µ–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker exec -it speech-app /bin/bash
```

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–∑–º—ñ—Ä—É –æ–±—Ä–∞–∑—É
```bash
# –ü–æ–¥–∏–≤–∏—Ç–∏—Å—è —Ä–æ–∑–º—ñ—Ä–∏ –≤—Å—ñ—Ö –µ—Ç–∞–ø—ñ–≤
docker images | grep speech

# –î–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è
docker image inspect speech-commands-app
```

## üìä –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è

### –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Docker Compose
–°—Ç–≤–æ—Ä—ñ—Ç—å `docker-compose.yml`:

```yaml
version: '3.8'

services:
  speech-app:
    build: .
    container_name: speech-commands-app
    ports:
      - "8000:8000"
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health')"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s
```

–ó–∞–ø—É—Å–∫:
```bash
# –ó–±—É–¥—É–≤–∞—Ç–∏ —Ç–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–∏
docker-compose up -d

# –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ª–æ–≥–∏
docker-compose logs -f

# –ó—É–ø–∏–Ω–∏—Ç–∏
docker-compose down
```

### Build –∑ –∫–µ—à—É–≤–∞–Ω–Ω—è–º
```bash
# –ü–µ—Ä—à–∏–π —Ä–∞–∑ –∑–±—ñ—Ä–∫–∞ –∑–∞–π–º–µ –±—ñ–ª—å—à–µ —á–∞—Å—É
docker build -t speech-commands-app .

# –ü–æ–≤—Ç–æ—Ä–Ω—ñ –∑–±—ñ—Ä–∫–∏ –±—É–¥—É—Ç—å —à–≤–∏–¥—à—ñ –∑–∞–≤–¥—è–∫–∏ –∫–µ—à—É
docker build -t speech-commands-app .

# –ü—Ä–∏–º—É—Å–æ–≤–∞ –∑–±—ñ—Ä–∫–∞ –±–µ–∑ –∫–µ—à—É
docker build --no-cache -t speech-commands-app .
```

### –ó–±—ñ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –µ—Ç–∞–ø—É (–¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è)
```bash
# –¢—ñ–ª—å–∫–∏ builder –µ—Ç–∞–ø
docker build --target builder -t speech-builder .

# –¢—ñ–ª—å–∫–∏ trainer –µ—Ç–∞–ø (–∑ –Ω–∞–≤—á–∞–Ω–Ω—è–º)
docker build --target trainer -t speech-trainer .

# –ü–æ–≤–Ω–∞ –∑–±—ñ—Ä–∫–∞ –¥–æ runtime
docker build --target runtime -t speech-commands-app .
```

## üéØ –Ø–∫ –ø—Ä–∞—Ü—é—î –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –º–æ–¥–µ–ª—ñ

–ü—ñ–¥ —á–∞—Å –µ—Ç–∞–ø—É `trainer` –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è —Å–∫—Ä–∏–ø—Ç `train_if_needed.sh`:

```bash
#!/bin/bash
set -e
echo "üîç –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –Ω–∞—Ç—Ä–µ–Ω–æ–≤–∞–Ω–æ—ó –º–æ–¥–µ–ª—ñ..."
if [ -f "model_state_dict.pt" ]; then
    echo "‚úÖ –ú–æ–¥–µ–ª—å –∑–Ω–∞–π–¥–µ–Ω–∞: model_state_dict.pt"
    echo "üìè –†–æ–∑–º—ñ—Ä –º–æ–¥–µ–ª—ñ: $(du -h model_state_dict.pt | cut -f1)"
else
    echo "‚ùå –ú–æ–¥–µ–ª—å –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∞!"
    echo "üöÄ –ó–∞–ø—É—Å–∫–∞—î–º–æ –Ω–∞–≤—á–∞–Ω–Ω—è –º–æ–¥–µ–ª—ñ..."
    echo "‚è∞ –¶–µ –º–æ–∂–µ –∑–∞–π–Ω—è—Ç–∏ –∫—ñ–ª—å–∫–∞ —Ö–≤–∏–ª–∏–Ω..."
    python speech_commands_train.py
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —â–æ –º–æ–¥–µ–ª—å —Å—Ç–≤–æ—Ä–µ–Ω–∞
    if [ -f "model_state_dict.pt" ]; then
        echo "‚úÖ –ú–æ–¥–µ–ª—å —É—Å–ø—ñ—à–Ω–æ –Ω–∞–≤—á–µ–Ω–∞ —ñ –∑–±–µ—Ä–µ–∂–µ–Ω–∞!"
        echo "üìè –†–æ–∑–º—ñ—Ä –º–æ–¥–µ–ª—ñ: $(du -h model_state_dict.pt | cut -f1)"
    else
        echo "‚ùå –ü–æ–º–∏–ª–∫–∞: –º–æ–¥–µ–ª—å –Ω–µ –±—É–ª–∞ —Å—Ç–≤–æ—Ä–µ–Ω–∞"
        exit 1
    fi
fi
```

## üìà –ü–µ—Ä–µ–≤–∞–≥–∏ –±–∞–≥–∞—Ç–æ—Å—Ç—É–ø–µ–Ω–µ–≤–æ—ó –∑–±—ñ—Ä–∫–∏

1. **üîí –ë–µ–∑–ø–µ–∫–∞**: –§—ñ–Ω–∞–ª—å–Ω–∏–π –æ–±—Ä–∞–∑ –Ω–µ –º—ñ—Å—Ç–∏—Ç—å —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ –¥–ª—è –∑–±—ñ—Ä–∫–∏
2. **üíæ –†–æ–∑–º—ñ—Ä**: Runtime –æ–±—Ä–∞–∑ –º–µ–Ω—à–∏–π, –±–µ–∑ build-–∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π
3. **üöÄ –®–≤–∏–¥–∫—ñ—Å—Ç—å**: –ü–æ–≤—Ç–æ—Ä–Ω—ñ –∑–±—ñ—Ä–∫–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –∫–µ—à
4. **üéØ –ì–Ω—É—á–∫—ñ—Å—Ç—å**: –ú–æ–∂–Ω–∞ –∑–±—É–¥—É–≤–∞—Ç–∏ –∑ –º–æ–¥–µ–ª–ª—é –∞–±–æ –±–µ–∑ –Ω–µ—ó
5. **üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è**: –ú–æ–∂–Ω–∞ –∑–±—É–¥—É–≤–∞—Ç–∏ –æ–∫—Ä–µ–º—ñ –µ—Ç–∞–ø–∏ –¥–ª—è –¥–µ–±–∞–≥—É

## ‚ö†Ô∏è –í–∞–∂–ª–∏–≤—ñ –ø—Ä–∏–º—ñ—Ç–∫–∏

1. **–ß–∞—Å –∑–±—ñ—Ä–∫–∏**: –ü–µ—Ä—à–∞ –∑–±—ñ—Ä–∫–∞ –±–µ–∑ –º–æ–¥–µ–ª—ñ –∑–∞–π–º–µ ~5-15 —Ö–≤–∏–ª–∏–Ω (–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ CPU)
2. **–Ü–Ω—Ç–µ—Ä–Ω–µ—Ç**: –ü–æ—Ç—Ä—ñ–±–µ–Ω –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞—Ç–∞—Å–µ—Ç—É Speech Commands (~2GB)
3. **–ü–∞–º'—è—Ç—å**: –†–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –º—ñ–Ω—ñ–º—É–º 4GB RAM –¥–ª—è –Ω–∞–≤—á–∞–Ω–Ω—è
4. **–ü—Ä–æ—Å—Ç—ñ—Ä**: –ü–æ—Ç—Ä—ñ–±–Ω–æ ~3-4GB –≤—ñ–ª—å–Ω–æ–≥–æ –º—ñ—Å—Ü—è –¥–ª—è –¥–∞–Ω–∏—Ö —Ç–∞ –æ–±—Ä–∞–∑—É

## üîß –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –¥–ª—è production

### –ó–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞
```bash
docker run -d -p 8000:8000 \
    -e PYTHONUNBUFFERED=1 \
    -e FLASK_ENV=production \
    --name speech-app \
    speech-commands-app
```

### –û–±–º–µ–∂–µ–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤
```bash
docker run -d -p 8000:8000 \
    --memory="2g" \
    --cpus="2" \
    --name speech-app \
    speech-commands-app
```

### –ó restart policy
```bash
docker run -d -p 8000:8000 \
    --restart unless-stopped \
    --name speech-app \
    speech-commands-app
```

## üìù –õ–æ–≥–∏ –∑–±—ñ—Ä–∫–∏

–ü—Ä–∏ –∑–±—ñ—Ä—Ü—ñ –≤–∏ –ø–æ–±–∞—á–∏—Ç–µ:

```
[+] Building 234.5s (15/15) FINISHED
 => [builder 1/8] FROM python:3.10-slim
 => [builder 2/8] RUN apt-get update && apt-get install...
 => [builder 3/8] COPY requirements.txt /app/
 => [builder 4/8] RUN pip install --no-cache-dir "numpy<2"
 => [builder 5/8] RUN pip install --no-cache-dir torch...
 => [builder 6/8] RUN pip install --no-cache-dir -r...
 => [builder 7/8] COPY model_utils.py speech_commands_train.py...
 => [trainer 1/2] RUN echo '#!/bin/bash...
 => [trainer 2/2] RUN /app/train_if_needed.sh
 => [runtime 1/6] RUN apt-get update && apt-get install...
 => [runtime 2/6] RUN pip install --no-cache-dir "numpy<2"
 => [runtime 3/6] RUN pip install --no-cache-dir torch...
 => [runtime 4/6] COPY requirements.txt /app/
 => [runtime 5/6] COPY model_utils.py app.py ./
 => [runtime 6/6] COPY --from=trainer /app/model_state_dict.pt...
 => exporting to image
```

## üéì –í–∏—Å–Ω–æ–≤–æ–∫

–¶—è –±–∞–≥–∞—Ç–æ—Å—Ç—É–ø–µ–Ω–µ–≤–∞ –∑–±—ñ—Ä–∫–∞ –¥–æ–∑–≤–æ–ª—è—î:
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –Ω–∞–≤—á–∏—Ç–∏ –º–æ–¥–µ–ª—å –ø—ñ–¥ —á–∞—Å –∑–±—ñ—Ä–∫–∏ (—è–∫—â–æ —ó—ó –Ω–µ–º–∞—î)
- ‚úÖ –ü—Ä–æ–ø—É—Å—Ç–∏—Ç–∏ –Ω–∞–≤—á–∞–Ω–Ω—è (—è–∫—â–æ –º–æ–¥–µ–ª—å –≤–∂–µ —î)
- ‚úÖ –û—Ç—Ä–∏–º–∞—Ç–∏ –ª–µ–≥–∫–∏–π production-ready –æ–±—Ä–∞–∑
- ‚úÖ –õ–µ–≥–∫–æ –º–∞—Å—à—Ç–∞–±—É–≤–∞—Ç–∏ —Ç–∞ —Ä–æ–∑–≥–æ—Ä—Ç–∞—Ç–∏

**–ó–∞–ø—É—Å—Ç—ñ—Ç—å –ø—Ä–æ–µ–∫—Ç –æ–¥–Ω—ñ—î—é –∫–æ–º–∞–Ω–¥–æ—é:**
```bash
docker build -t speech-commands-app . && docker run -d -p 8000:8000 speech-commands-app
```

–ì–æ—Ç–æ–≤–æ! üéâ
