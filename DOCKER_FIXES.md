# üîß –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –¥–ª—è Docker –∑–±—ñ—Ä–∫–∏

## –ü—Ä–æ–±–ª–µ–º–∏ —Ç–∞ —ó—Ö –≤–∏—Ä—ñ—à–µ–Ω–Ω—è

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ 1: RuntimeError - backend –¥–ª—è torchaudio

```
RuntimeError: Couldn't find appropriate backend to handle uri .../one/821b64cc_nohash_1.wav
```

**–ü—Ä–∏—á–∏–Ω–∞**: –£ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ –≤—ñ–¥—Å—É—Ç–Ω—ñ–π backend –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∞—É–¥—ñ–æ —Ñ–∞–π–ª—ñ–≤ —á–µ—Ä–µ–∑ torchaudio.

**–†—ñ—à–µ–Ω–Ω—è**:
1. –î–æ–¥–∞–Ω–æ `soundfile>=0.12.0` –¥–æ `requirements.txt`
2. –î–æ–¥–∞–Ω–æ —è–≤–Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è soundfile –≤ Dockerfile
3. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –∑–º—ñ–Ω–Ω—É —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ `TORCHAUDIO_BACKEND=soundfile`

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ 2: Segmentation fault (exit code 139)

```
Segmentation fault (core dumped)
failed to solve: exit code: 139
```

**–ü—Ä–∏—á–∏–Ω–∞**: –ù–∞–≤—á–∞–Ω–Ω—è –º–æ–¥–µ–ª—ñ –Ω–∞ **34 –∫–ª–∞—Å–∞—Ö** –∑ **81,757 –∑—Ä–∞–∑–∫–∞–º–∏** –≤–∏–º–∞–≥–∞—î –∑–∞–Ω–∞–¥—Ç–æ –±–∞–≥–∞—Ç–æ –ø–∞–º'—è—Ç—ñ –¥–ª—è Docker –∑–±—ñ—Ä–∫–∏.

**–†—ñ—à–µ–Ω–Ω—è**:
1. –ó–º–µ–Ω—à–µ–Ω–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∫–ª–∞—Å—ñ–≤ –¥–æ **4** (`yes`, `no`, `up`, `down`)
2. –ó–º–µ–Ω—à–µ–Ω–æ `BATCH_SIZE` –∑ 64 –¥–æ **32**
3. –ó–º–µ–Ω—à–µ–Ω–æ `EPOCHS` –∑ 10 –¥–æ **3** –¥–ª—è —à–≤–∏–¥—à–æ—ó –∑–±—ñ—Ä–∫–∏
4. –¢–µ–ø–µ—Ä –¥–∞—Ç–∞—Å–µ—Ç: ~2,400 train –∑—Ä–∞–∑–∫—ñ–≤ –∑–∞–º—ñ—Å—Ç—å 81,757

## –©–æ –∑–º—ñ–Ω–µ–Ω–æ

### 1. `requirements.txt`
```diff
torch>=1.9.0
torchaudio>=0.9.0
flask>=2.0.0
numpy>=1.21.0
pydub>=0.25.0
+ soundfile>=0.12.0
```

### 2. `speech_commands_train.py`
```python
# –ë—É–ª–æ: 34 –∫–ª–∞—Å–∏
CLASSES = [
    "yes", "no", "up", "down", "zero", "wow", "visual", ...
]

# –°—Ç–∞–ª–æ: 4 –∫–ª–∞—Å–∏ (–¥–ª—è Docker)
CLASSES = [
    "yes", "no", "up", "down"
]

# –ë—É–ª–æ
BATCH_SIZE = 64
EPOCHS = 10

# –°—Ç–∞–ª–æ
BATCH_SIZE = 32  # –ó–º–µ–Ω—à–µ–Ω–æ –¥–ª—è Docker –∑–±—ñ—Ä–∫–∏
EPOCHS = 3       # –î–ª—è —à–≤–∏–¥—à–æ—ó –∑–±—ñ—Ä–∫–∏
```

### 3. `Dockerfile` - Builder –µ—Ç–∞–ø
```dockerfile
# –î–æ–¥–∞–Ω–æ –ø—ñ—Å–ª—è –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –∫–æ–¥—É
RUN pip install --no-cache-dir soundfile>=0.12.0
ENV TORCHAUDIO_BACKEND=soundfile
```

### 4. `Dockerfile` - Runtime –µ—Ç–∞–ø
```dockerfile
# –î–æ–¥–∞–Ω–æ –ø—ñ—Å–ª—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è requirements
RUN pip install --no-cache-dir soundfile>=0.12.0
ENV TORCHAUDIO_BACKEND=soundfile
```

## –û—á—ñ–∫—É–≤–∞–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏

### –î–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å:
- ‚ùå –ó–±—ñ—Ä–∫–∞ –ø–∞–¥–∞–ª–∞ –∑ Segmentation fault
- ‚ùå ~81,757 train –∑—Ä–∞–∑–∫—ñ–≤ (34 –∫–ª–∞—Å–∏)
- ‚ùå –ß–∞—Å –Ω–∞–≤—á–∞–Ω–Ω—è: ~20-30 —Ö–≤–∏–ª–∏–Ω
- ‚ùå –ü–∞–º'—è—Ç—å: ~4-6GB+

### –ü—ñ—Å–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å:
- ‚úÖ –ó–±—ñ—Ä–∫–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —É—Å–ø—ñ—à–Ω–æ
- ‚úÖ ~2,400 train –∑—Ä–∞–∑–∫—ñ–≤ (4 –∫–ª–∞—Å–∏)
- ‚úÖ –ß–∞—Å –Ω–∞–≤—á–∞–Ω–Ω—è: ~3-5 —Ö–≤–∏–ª–∏–Ω
- ‚úÖ –ü–∞–º'—è—Ç—å: ~1-2GB

## –Ø–∫ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏

```bash
# –û—á–∏—Å—Ç–∏—Ç–∏ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ —Å–ø—Ä–æ–±–∏
docker stop speech-app 2>/dev/null || true
docker rm speech-app 2>/dev/null || true
docker rmi speech-commands-app 2>/dev/null || true

# –ù–æ–≤–∞ –∑–±—ñ—Ä–∫–∞
docker build -t speech-commands-app .

# –ó–∞–ø—É—Å–∫
docker run -d -p 8000:8000 --name speech-app speech-commands-app

# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞
curl http://localhost:8000/health
curl http://localhost:8000/info
```

## –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –Ω–∞–≤—á–∞–Ω–Ω—è –∑ —É—Å—ñ–º–∞ –∫–ª–∞—Å–∞–º–∏

–Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –Ω–∞–≤—á–∏—Ç–∏ –º–æ–¥–µ–ª—å –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ –≤—Å—ñ—Ö 34 –∫–ª–∞—Å–∞—Ö:

```python
# –£ speech_commands_train.py —Ä–æ–∑–∫–æ–º–µ–Ω—Ç—É–π—Ç–µ:
CLASSES = [
    "yes", "no", "up", "down", "zero", "wow", "visual", "two", "tree", "three",
    "stop", "six", "sheila", "seven", "right", "one", "off", "nine", "marvin",
    "left", "learn", "house", "happy", "go", "four", "forward", "follow", "five",
    "eight", "dog", "cat", "bird", "bed", "backward"
]
BATCH_SIZE = 64
EPOCHS = 10
```

–ü–æ—Ç—ñ–º –∑–∞–ø—É—Å—Ç—ñ—Ç—å:
```bash
python speech_commands_train.py
```

–ê–ª–µ –≤ `app.py` **–æ–±–æ–≤'—è–∑–∫–æ–≤–æ** –∑–º—ñ–Ω—ñ—Ç—å:
```python
CLASSES = [
    "yes", "no", "up", "down", "zero", ... # –≤—Å—ñ 34 –∫–ª–∞—Å–∏
]
N_CLASSES = 34
```

## –í–∞–∂–ª–∏–≤–æ

- Docker –∑–±—ñ—Ä–∫–∞ –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∞ –¥–ª—è **—à–≤–∏–¥–∫–æ—Å—Ç—ñ** —Ç–∞ **–Ω–∞–¥—ñ–π–Ω–æ—Å—Ç—ñ**
- –î–ª—è production –º–æ–∂–µ—Ç–µ –Ω–∞–≤—á–∏—Ç–∏ –º–æ–¥–µ–ª—å –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ –≤—Å—ñ—Ö –∫–ª–∞—Å–∞—Ö
- –ü—ñ—Å–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –Ω–∞–≤—á–∞–Ω–Ω—è —Å–∫–æ–ø—ñ—é–π—Ç–µ `model_state_dict.pt` –≤ –ø—Ä–æ–µ–∫—Ç
- Docker –∑–±—ñ—Ä–∫–∞ –∑–Ω–∞–π–¥–µ –≥–æ—Ç–æ–≤—É –º–æ–¥–µ–ª—å —ñ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –Ω–∞–≤—á–∞–Ω–Ω—è

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –ø—ñ—Å–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å

```bash
# –ó–±—ñ—Ä–∫–∞ (–º–∞—î –ø—Ä–æ–π—Ç–∏ –±–µ–∑ –ø–æ–º–∏–ª–æ–∫ –∑–∞ ~5-10 —Ö–≤–∏–ª–∏–Ω)
time docker build -t speech-commands-app .

# –û—á—ñ–∫—É–≤–∞–Ω–∏–π –≤–∏–≤—ñ–¥:
# ‚úÖ –ú–æ–¥–µ–ª—å –∑–Ω–∞–π–¥–µ–Ω–∞ –∞–±–æ –Ω–∞–≤—á–µ–Ω–∞
# ‚úÖ –ó–±—ñ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø—ñ—à–Ω–æ
# ‚úÖ –§—ñ–Ω–∞–ª—å–Ω–∏–π –æ–±—Ä–∞–∑ ~1.8GB

# –ó–∞–ø—É—Å–∫
docker run -d -p 8000:8000 --name speech-app speech-commands-app

# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ API
curl -s http://localhost:8000/info | python3 -m json.tool

# –û—á—ñ–∫—É–≤–∞–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å:
{
  "model": "SmallCNN",
  "classes": ["yes", "no", "up", "down"],
  "n_classes": 4,
  "device": "cpu",
  "parameters": 1089540  # –ú–µ–Ω—à–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ –¥–ª—è 4 –∫–ª–∞—Å—ñ–≤
}
```

## –ü—ñ–¥—Å—É–º–æ–∫

‚úÖ **–ü—Ä–æ–±–ª–µ–º–∞ –∑ backend –≤–∏—Ä—ñ—à–µ–Ω–∞** - –¥–æ–¥–∞–Ω–æ soundfile  
‚úÖ **Segmentation fault –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ** - –∑–º–µ–Ω—à–µ–Ω–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∫–ª–∞—Å—ñ–≤  
‚úÖ **–ó–±—ñ—Ä–∫–∞ –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∞** - —à–≤–∏–¥—à–µ –Ω–∞–≤—á–∞–Ω–Ω—è –≤ Docker  
‚úÖ **–ì–Ω—É—á–∫—ñ—Å—Ç—å –∑–±–µ—Ä–µ–∂–µ–Ω–∞** - –º–æ–∂–Ω–∞ –Ω–∞–≤—á–∏—Ç–∏ –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ –≤—Å—ñ—Ö –∫–ª–∞—Å–∞—Ö  

üéâ **–¢–µ–ø–µ—Ä Docker –∑–±—ñ—Ä–∫–∞ –ø—Ä–∞—Ü—é—î —Å—Ç–∞–±—ñ–ª—å–Ω–æ!**
